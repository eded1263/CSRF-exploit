<?php 

Class CSRF{

    public function exploit($argv){
        if(in_array('-url', $argv)){
            $url = $argv[array_search('-url', $argv)+1];
        }else{
            echo "Nenhuma url foi especificada";
            die();
        }
        
        if(in_array('-p', $argv)){
            $post_fields = $argv[array_search('-p', $argv)+1];
        }else{
            echo "Não foi passado os postfields!";
            die();
        }
        
        if(in_array('-proxy', $argv)){
            $proxy = $argv[array_search('-proxy', $argv)+1];
            $proxy = explode(':', $proxy);
            if(in_array('-proxy-u', $argv)){
                $usuario = $argv[array_search('-proxy-u', $argv)+1];
                if(in_array('-proxy-s', $argv)){
                    $senha = $argv[array_search('-proxy-s', $argv)+1];
                }
            }
        }else{
            $proxy[0] = null;
            $proxy[1] = null;
        }
        
        $ch = curl_init();
        curl_setopt($ch, CURLOPT_URL, $url);
        curl_setopt($ch, CURLOPT_HEADER, 0);
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
        curl_setopt($ch, CURLOPT_PROXY, $proxy[0]);
        curl_setopt($ch, CURLOPT_PROXYPORT, $proxy[1]);
        if(isset($senha)) curl_setopt($ch, CURLOPT_PROXYUSERPWD, $usuario.":".$senha); 
        curl_setopt($ch, CURLOPT_POST, 1);
        curl_setopt($ch, CURLOPT_POSTFIELDS, "$post_fields");
        curl_setopt($ch, CURLOPT_USERAGENT, "");
        $exec = curl_exec($ch);
        if ($exec === false) {
            throw new Exception(curl_error($ch), curl_errno($ch));
        }
        if($exec){
            echo "requisição finalizada, retorno:";
            echo " \n $exec";
        }
    }
}