<?php 


if($argv[0] == 'exploit'){
    array_splice($argv, 0,1);
}

if(!isset($argv[0]) || $argv[0] == '-h'){
    echo " Exploit de CSRF! \n Desenvolvido por: eded1263 \n";
    echo " Como usar: \n -url : define a url que deve ser utilizada \n -p : Posfields a serem utilizados, p.E: \"chave=valor&chave=valor\"";
    echo " \n -proxy: url:porta, proxy a ser utilizado (opcional)";
    echo " \n -proxy-u: usuario para o proxy (opcional) ";
    echo " \n -proxy-s: senha para o proxy (opcional) ";
    echo " \n -h : exibe o menu de ajuda ";
    die();
}
if(in_array('-url', $argv)){
    $url = $argv[array_search('-url', $argv)+1];
}else{
    echo "Nenhuma url foi especificada";
    die();
}

if(in_array('-p', $argv)){
    $post_fields = $argv[array_search('-p', $argv)+1];
}else{
    echo "Não foi passado os postfields!";
    die();
}

if(in_array('-proxy', $argv)){
    $proxy = $argv[array_search('-proxy', $argv)+1];
    $proxy = explode(':', $proxy);
    if(in_array('-proxy-u', $argv)){
        $usuario = $argv[array_search('-proxy-u', $argv)+1];
        if(in_array('-proxy-s', $argv)){
            $senha = $argv[array_search('-proxy-s', $argv)+1];
        }
    }
}else{
    $proxy[0] = null;
    $proxy[1] = null;
}

$ch = curl_init();
curl_setopt($ch, CURLOPT_URL, $url);
curl_setopt($ch, CURLOPT_HEADER, 0);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
curl_setopt($ch, CURLOPT_PROXY, $proxy[0]);
curl_setopt($ch, CURLOPT_PROXYPORT, $proxy[1]);
if(isset($senha)) curl_setopt($ch, CURLOPT_PROXYUSERPWD, $usuario.":".$senha); 
curl_setopt($ch, CURLOPT_POST, 1);
curl_setopt($ch, CURLOPT_POSTFIELDS, "$post_fields");
curl_setopt($ch, CURLOPT_USERAGENT, "");
$exec = curl_exec($ch);
if ($exec === false) {
    throw new Exception(curl_error($ch), curl_errno($ch));
}
if($exec){
    echo "requisição finalizada, retorno:";
    echo " \n $exec";
}




